{% extends 'base.html' %}
{% load omfilters %}

{% block titulo %}Resumo da compra | {% endblock %}

{% block conteudo %}
<div class="row mt-4 mb-5">
    <!-- Dados do usuário e endereço -->
    <div class="col-lg-7 mb-4">
        <!-- Dados do usuário -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-0">Seus dados</h4>
                    <small class="text-muted">Confira se está tudo correto antes de finalizar.</small>
                </div>
                <a href="{% url 'perfil:criar' %}" class="btn btn-sm btn-outline-primary">
                    Editar
                </a>
            </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-3 col-lg-3">Nome</dt>
                    <dd class="col-sm-9 col-lg-9">{{ usuario.first_name }} {{ usuario.last_name }}</dd>

                    <dt class="col-sm-3 col-lg-3">Idade</dt>
                    <dd class="col-sm-9 col-lg-9">{{ usuario.perfil.idade }}</dd>

                    <dt class="col-sm-3 col-lg-3">Nascimento</dt>
                    <dd class="col-sm-9 col-lg-9">{{ usuario.perfil.data_nascimento }}</dd>

                    <dt class="col-sm-3 col-lg-3">CPF</dt>
                    <dd class="col-sm-9 col-lg-9">{{ usuario.perfil.cpf }}</dd>

                    <dt class="col-sm-3 col-lg-3">E-mail</dt>
                    <dd class="col-sm-9 col-lg-9">{{ usuario.email }}</dd>
                </dl>
            </div>
        </div>

        <!-- Endereço -->
        <div class="card shadow-sm border-0">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-0">Endereço de entrega</h5>
                    <small class="text-muted">Este será utilizado para envio dos produtos.</small>
                </div>
                <a href="{% url 'perfil:criar' %}" class="btn btn-sm btn-outline-primary">
                    Editar
                </a>
            </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-3 col-lg-3">Endereço</dt>
                    <dd class="col-sm-9 col-lg-9">
                        {{ usuario.perfil.endereco }}, {{ usuario.perfil.numero }}
                        {% if usuario.perfil.complemento %}
                        - {{ usuario.perfil.complemento }}
                        {% endif %}
                    </dd>

                    <dt class="col-sm-3 col-lg-3">Bairro</dt>
                    <dd class="col-sm-9 col-lg-9">{{ usuario.perfil.bairro }}</dd>

                    <dt class="col-sm-3 col-lg-3">Cidade/UF</dt>
                    <dd class="col-sm-9 col-lg-9">
                        {{ usuario.perfil.cidade }} - {{ usuario.perfil.estado }}
                    </dd>

                    <dt class="col-sm-3 col-lg-3">CEP</dt>
                    <dd class="col-sm-9 col-lg-9">{{ usuario.perfil.cep }}</dd>
                </dl>
            </div>
        </div>
    </div>

    <!-- Resumo financeiro e botão de finalizar -->
    <div class="col-lg-5 mb-4">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-light">
                <h5 class="mb-0">Resumo da compra</h5>
            </div>
            <div class="card-body">
                <p class="mb-2 text-muted">
                    Confira o valor total antes de concluir seu pedido.
                </p>

                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>Subtotal</span>
                        <span>{{ subtotal|formata_preco }}</span>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>Frete</span>
                        <span>{{ frete|formata_preco }}</span>
                    </div>

                    <hr>

                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="font-weight-bold">Total</span>
                        <span class="h5 mb-0 text-success">{{ total|formata_preco }}</span>
                    </div>

                <p class="small text-muted mb-4">
                    Eventuais ajustes de frete ou condições de pagamento podem ser apresentados na próxima etapa.
                </p>

                <a class="btn btn-primary btn-lg btn-block" href="{% url 'pedido:salvarpedido' %}">
                    Realizar pedido e pagar
                </a>

                <a href="{% url 'produto:lista' %}" class="btn btn-link btn-sm d-block mt-2 p-0">
                    <i class="fas fa-arrow-left mr-1"></i> Voltar para os produtos
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Lista dos itens do carrinho -->
<div class="row mb-4">
    <div class="col">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Itens do carrinho</h5>
                <small class="text-muted">
                    Produtos, quantidades e preços selecionados.
                </small>
            </div>
            <div class="card-body p-0">
                {% include 'parciais/_carrinho.html' %}
            </div>
        </div>
    </div>
</div>
{% endblock %}